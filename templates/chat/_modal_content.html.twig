{# templates/chat/_modal_content.html.twig #}
{% set includeStyles = includeStyles is defined ? includeStyles : true %}
{% if includeStyles %}
<style>
    .message {
        background-color: #f0f0f0;
        padding: 10px;
        margin-bottom: 8px;
        border-radius: 5px;
    }
    .message-form {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    .message-input {
        flex-grow: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .chat-container {
        max-width: 800px;
        margin: 20px auto;
        padding: 15px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .messages {
        max-height: 400px;
        overflow-y: auto;
        padding: 10px;
        border: 1px solid #eee;
        border-radius: 4px;
        margin-bottom: 15px;
    }
    .timestamp {
        color: #777;
        font-size: 0.8em;
        margin-left: 10px;
    }
    .username-readonly {
        background-color: #f5f5f5;
        cursor: not-allowed;
    }
    .message-pending {
        opacity: 0.7;
        border-left: 3px solid #ffc107;
    }
    .message-error {
        border-left: 3px solid #dc3545;
    }
    .message-error-info {
        color: #dc3545;
        font-size: 0.8em;
        margin-top: 5px;
    }
</style>
{% endif %}
<div class="chat-container" data-room-id="{{ roomId }}"{% if roomToken %} data-room-token="{{ roomToken }}"{% endif %} data-mercure-url="{{ mercure_public_url }}">
    <h1>Chat priv√© - Room {{ roomId }}</h1>

    <div class="messages" id="messages">
        {% for message in messages %}
            <div class="message">
                <strong>{{ message.sender }}</strong>
                <span class="timestamp">{{ message.timestamp|date('Y-m-d H:i:s') }}</span>
                <p>{{ message.content }}</p>
            </div>
        {% endfor %}
    </div>

    <form action="{{ path('chat_send', {roomId: roomId}) }}" method="post" class="message-form" data-ajax="true">
        {% if not isAdminContext %}
            <input type="hidden" name="roomToken" value="{{ roomToken }}">
        {% endif %}
        {% if isAdminContext %}
            <input type="hidden" name="_token" value="{{ csrf_token('chat_message') }}">
        {% endif %}
        <input type="text" name="username" id="chat-username" value="{{ userName }}" class="message-input {% if hasUsername %}username-readonly{% endif %}" placeholder="Votre nom" required {% if hasUsername %}readonly{% endif %}>
        <input type="text" name="message" id="chat-message" class="message-input" placeholder="Votre message" required>
        <button type="submit" class="btn btn-primary">Envoyer</button>
    </form>
</div>
